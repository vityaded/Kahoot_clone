<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>Quiz Control Hub</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body class="library">
  <div class="glow"></div>
  <header class="hero">
    <div>
      <p class="eyebrow">Quiz console</p>
      <h1>Pick a quiz, share the code, and get playing</h1>
      <p class="lede">A hub to browse everything you've created, launch a live session, and send learners to the right join page.</p>
      <div class="cta-row">
        <a class="button" href="/create.html">Create a new quiz</a>
        <a class="button ghost" href="/run.html">Run an existing quiz</a>
        <a class="button ghost" href="/join.html">Player join page</a>
      </div>
    </div>
    <div class="hero-card">
      <h2>Quick start</h2>
      <ol>
        <li>Build a quiz in <strong>Create</strong>.</li>
        <li>Open <strong>Run</strong> with your quiz code to control the game.</li>
        <li>Send players to <strong>Join</strong> to enter the quiz code.</li>
      </ol>
    </div>
  </header>

  <main class="library-grid">
    <section class="card">
      <div class="card-heading">
        <div>
          <p class="eyebrow">Library</p>
          <h2>Your quizzes (newest first)</h2>
          <p class="muted">Created quizzes stay here in chronological order so you can relaunch them quickly.</p>
        </div>
        <button type="button" id="refresh-library" class="ghost">Refresh</button>
      </div>
      <ul id="quiz-list" class="quiz-list"></ul>
      <p id="empty-state" class="muted">No quizzes yet. Create one to see it appear here.</p>
    </section>
  </main>

  <script>
    const quizList = document.getElementById('quiz-list');
    const emptyState = document.getElementById('empty-state');
    const refreshBtn = document.getElementById('refresh-library');

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
    }

    function renderQuizList(quizzes) {
      quizList.innerHTML = '';
      if (!quizzes.length) {
        emptyState.style.display = 'block';
        return;
      }
      emptyState.style.display = 'none';
      quizzes.forEach((quiz) => {
        const item = document.createElement('li');
        item.className = 'quiz-row';
        item.innerHTML = `
          <div>
            <p class="eyebrow">${quiz.id}</p>
            <h3>${quiz.title}</h3>
            <p class="muted">${quiz.questionCount} question${quiz.questionCount === 1 ? '' : 's'} Â· Created ${formatDate(quiz.createdAt)}</p>
          </div>
          <div class="quiz-actions">
            <a class="button ghost" href="/run.html?quizId=${quiz.id}">Run</a>
            <button type="button" class="copy" data-code="${quiz.id}">Copy code</button>
          </div>
        `;
        quizList.appendChild(item);
      });
      quizList.querySelectorAll('.copy').forEach((button) => {
        button.addEventListener('click', () => {
          navigator.clipboard.writeText(button.dataset.code);
          button.textContent = 'Copied!';
          setTimeout(() => { button.textContent = 'Copy code'; }, 1200);
        });
      });
    }

    async function loadQuizzes() {
      try {
        const response = await fetch('/api/quizzes');
        const data = await response.json();
        renderQuizList(data);
      } catch (error) {
        emptyState.textContent = 'Unable to load quizzes right now.';
        emptyState.style.display = 'block';
      }
    }

    refreshBtn.addEventListener('click', loadQuizzes);
    loadQuizzes();
  </script>
</body>
</html>
