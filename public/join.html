<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>Join Quiz</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="glow"></div>
  <header>
    <h1>Join a live quiz</h1>
    <p>Type the game code from your host to get started. We'll grab your nickname next.</p>
    <div class="cta-row">
      <a class="button ghost" href="/">Back to library</a>
    </div>
  </header>

  <main class="grid single">
    <section class="card">
      <form id="join-form">
        <label>
          Game code
          <input type="text" id="quiz-code" placeholder="123456" required />
        </label>
        <button type="submit">Continue</button>
        <p id="join-error" class="error"></p>
      </form>
    </section>
  </main>

  <script>
    const joinForm = document.getElementById('join-form');
    const quizCode = document.getElementById('quiz-code');
    const joinError = document.getElementById('join-error');

    joinForm.addEventListener('submit', (event) => {
      event.preventDefault();
      const code = quizCode.value.trim().toUpperCase();
      if (!code) {
        joinError.textContent = 'Enter the game code your host is showing.';
        return;
      }
      localStorage.setItem('quizCode', code);
      localStorage.removeItem('playerName');
      window.location.href = '/nickname.html';
    });

    const params = new URLSearchParams(window.location.search);
    const paramCode = params.get('quizId');
    const autoJoin = params.get('autoJoin') === '1' || params.get('via') === 'qr';

    if (paramCode) {
      const upperCode = paramCode.trim().toUpperCase();
      quizCode.value = upperCode;

      if (autoJoin) {
        localStorage.setItem('quizCode', upperCode);
        localStorage.removeItem('playerName');
        window.location.href = '/nickname.html';
      }
    }
  </script>
</body>
</html>
